apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - github.com/jsa4000/homelab-ops//kubernetes/addons/observability/prometheus?ref=main

patches:
  - target:
      version: v1alpha1
      kind: IngressRoute
      name: grafana-ingress
    path: grafana-ingress-patch.yaml
  - target:
      version: v1alpha1
      kind: IngressRoute
      name: prometheus-ingress
    path: prometheus-ingress-patch.yaml
  - target:
      version: v1alpha1
      kind: IngressRoute
      name: alertmanager-ingress
    path: alertmanager-ingress-patch.yaml
  # In order to resize a persistent volume the storageclass must haver "allowVolumeExpansion" enabled (longhorn, rook-ceph, etc..)
  # For Prometheus is not enough to modify the Prometheus CRD, so it is needed to modify both the 'Prometheus' and 'PersistentVolumeClaim'.
  - target:
      version: v1
      kind: Prometheus
      name: prometheus-stack-kube-prom
    path: prometheus-patch.yaml
  - target:
      version: v1
      kind: PersistentVolumeClaim
      name: prometheus-prometheus-stack-kube-prom-db-prometheus-prometheus-stack-kube-prom-0
    path: prometheus-pvc-patch.yaml
