controllers:
  main:
    annotations:
      # Force to reload because configmap or secret changed. Use kustomization to generate maps with suffix instead.
      reloader.stakater.com/auto: "true"
    # Do not use replicas since it will be managed by KEDA, so argocd does not detect diffs.
    # replicas: 1
    strategy: RollingUpdate
    containers:
      main:
        image:
          repository: docker.io/excalidraw/excalidraw
          # Publishing the container image with tags in addition to "latest"
          # https://github.com/excalidraw/excalidraw/issues/8122
          tag: latest@sha256:ad64c71819a7908fe9ec3686b630d8c443df69b7029a1faa8c667df4168acd64
          pullPolicy: IfNotPresent
        probes:
          liveness:
            enabled: true
          readiness:
            enabled: true
          resources:
            requests:
              cpu: 5m
              memory: 10Mi
            limits:
              memory: 50Mi
        resources:
          requests:
            memory: 10Mi
            cpu: 10m
    pod:
      topologySpreadConstraints:
        - maxSkew: 1
          topologyKey: kubernetes.io/hostname
          whenUnsatisfiable: DoNotSchedule
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: excalidraw
service:
  main:
    controller: main
    ports:
      http:
        port: 80
