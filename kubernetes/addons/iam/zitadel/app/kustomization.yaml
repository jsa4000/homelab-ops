apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - masterkey.yaml
  # - secret-password.yaml
  - db-cert.yaml
  - secret-tls.yaml

helmCharts:
  - name: zitadel
    repo: https://charts.zitadel.com
    version: 7.12.1
    releaseName: zitadel
    namespace: iam
    valuesFile: values.yaml

configMapGenerator:
  - name: zitadel-config
    literals:
      - ZITADEL_EXTERNALDOMAIN=zitadel.default.javiersant.com

patches:
  - patch: |-
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: zitadel-config
        annotations:
          helm.sh/hook: pre-install,pre-upgrade
          helm.sh/hook-delete-policy: before-hook-creation
          helm.sh/hook-weight: "0"
