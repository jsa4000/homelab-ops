controllers:
  main:
    annotations:
      # Force to reload because configmap or secret changed. Use kustomization to generate maps with suffix instead.
      reloader.stakater.com/auto: "true"
    replicas: 1
    strategy: RollingUpdate
    containers:
      main:
        image:
          # Gotify has different container registries for different architectures
          #repository: ghcr.io/gotify/server
          repository: ghcr.io/druggeri/alertmanager_gotify_bridge
          tag: 2.4.0
        env:
          TZ: Europe/Madrid
          PORT: &port 80
          METRICS_PATH: &metrics /metrics
          GOTIFY_ENDPOINT: http://gotify.observability.svc.cluster.local:80/message
          # GOTIFY_TOKEN: 124
        envFrom:
          - secretRef:
              name: gotify-secret
        resources:
          requests:
            cpu: 15m

defaultPodOptions:
  automountServiceAccountToken: false
  securityContext:
    runAsNonRoot: true
    runAsUser: 568
    runAsGroup: 568
    fsGroup: 568
    fsGroupChangePolicy: OnRootMismatch
    seccompProfile: { type: RuntimeDefault }

service:
  main:
    controller: main
    ports:
      http:
        port: *port

serviceMonitor:
  exporter:
    enabled: true
    labels:
      release: prometheus-stack
    serviceName: gotify-webhook
    endpoints:
      - port: http
        scheme: http
        path: *metrics
        interval: 1m
        scrapeTimeout: 10s
